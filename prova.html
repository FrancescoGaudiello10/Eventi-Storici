<!doctype html>
<html>
<head>
  <title> WebSocket: Echo Server </title>
  <script>
  append = function(text){
    document.getElementById("eventi_websocket").insertAdjacentHTML('beforeend',
    "<li>" + text + ";</li>"
  );
  }
  //funzione che si avvia quando si apre la pagina web!
  window.onload = function(){
    var x=0;
    //var echo_service = new WebSocket('ws://echo.websocket.org');
    var echo_service = new WebSocket('ws://echo.websocket.org');

    echo_service.onmessage = function(event){
      append("messaggio ricevuto")
      alert(event.data);
      mia();
      if(x==4)
      echo_service.close();
    }
    //funzione che si avvia non appena
    echo_service.onopen = function(){
      append("connessione effettuata")
      echo_service.send("hello!");
    }
    function mia() {
      echo_service.send("io no pago afito!");
      append("ho inviato un nuovo messaggio!")
      x++;
    }
    echo_service.onclose = function(){
      append("connessione chiusa");
    }
    echo_service.onerror = function(){
      append("errore nella connessione");
    }
  }
  </script>
</head>
<body>
  <ul id="eventi_websocket">
  </ul>
</body>
</html>
